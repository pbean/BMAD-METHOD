template:
  id: game-architecture-advanced-template-v2
  name: Game Architecture Advanced Document
  version: 2.0
  output:
    format: markdown
    filename: docs/game-architecture-advanced.md
    title: "{{project_name}} Advanced Architecture"

workflow:
  mode: interactive
  elicitation: advanced-elicitation

sections:
  - id: introduction
    title: Advanced Architecture Overview
    content: |
      This document defines the advanced architectural considerations and production-ready features for {{project_name}}. This is Part 4 of the multi-phase architecture design, focusing on advanced Unity features, scalability, maintainability, and production operations.

      This document builds upon Foundation, Systems, and Platform Architecture documents. All previous architectural decisions inform the advanced techniques and patterns defined here.

  - id: addressables-architecture
    title: Addressables Asset Management Architecture
    instruction: |
      Design comprehensive Addressables system for scalable asset management:

      1. Analyze project asset complexity and distribution requirements
      2. Design Addressables group structure and loading strategies  
      3. Plan remote content delivery and caching mechanisms
      4. Configure platform-specific optimization settings
      5. Design asset lifecycle management and cleanup strategies

      Focus on production-ready asset management that scales with project growth.
    elicit: true
    sections:
      - id: addressables-configuration
        title: Addressables System Configuration
        template: |
          [[LLM: Analyze the project's asset complexity, target platforms, and distribution strategy to recommend appropriate Addressables configuration. For projects with <500 assets, recommend simpler local groups. For projects with 500-2000 assets, recommend hybrid local/remote groups. For projects with >2000 assets or live content updates, recommend advanced remote content delivery with CDN integration. Consider platform storage limitations (mobile vs desktop) and network connectivity requirements.]]

          **Addressables Group Structure:**
          - {{group_1}}: {{group_purpose_1}} ({{loading_strategy_1}})
          - {{group_2}}: {{group_purpose_2}} ({{loading_strategy_2}})
          - {{group_3}}: {{group_purpose_3}} ({{loading_strategy_3}})

          **Loading Strategies:**
          - {{strategy_1}}: {{strategy_implementation_1}}
          - {{strategy_2}}: {{strategy_implementation_2}}

          **Remote Content Configuration:**
          - CDN Setup: {{cdn_configuration}}
          - Caching Strategy: {{caching_approach}}
          - Update Mechanism: {{update_strategy}}

          **Performance Optimization:**
          - Bundle Size Limits: {{bundle_size_limits}}
          - Compression Settings: {{compression_config}}
          - Loading Priorities: {{priority_system}}
      - id: asset-lifecycle-management
        title: Asset Lifecycle Management
        template: |
          **Asset Loading Patterns:**
          - {{loading_pattern_1}}: {{pattern_use_case_1}}
          - {{loading_pattern_2}}: {{pattern_use_case_2}}

          **Memory Management:**
          - {{memory_strategy_1}}: {{cleanup_approach_1}}
          - {{memory_strategy_2}}: {{cleanup_approach_2}}

          **Asset Versioning:**
          - Version Control: {{versioning_approach}}
          - Rollback Strategy: {{rollback_mechanism}}
          - Dependency Tracking: {{dependency_management}}

  - id: advanced-unity-features
    title: Advanced Unity Features Integration
    instruction: |
      Plan integration of advanced Unity features and modern Unity ecosystem tools:

      1. Evaluate advanced Unity packages and features relevant to the project
      2. Plan integration of modern Unity tools (Timeline, Cinemachine, Visual Scripting)
      3. Consider Unity Gaming Services integration
      4. Plan for advanced rendering and graphics features
      5. Design integration approach that maintains architectural consistency

      Focus on features that provide significant value while maintaining code quality.
    elicit: true
    sections:
      - id: modern-unity-tools
        title: Modern Unity Tools Integration
        template: |
          **Timeline System Integration:**
          - {{timeline_usage_1}}: {{timeline_purpose_1}}
          - {{timeline_usage_2}}: {{timeline_purpose_2}}

          **Cinemachine Integration:**
          - {{cinemachine_usage_1}}: {{cinemachine_purpose_1}}
          - {{cinemachine_usage_2}}: {{cinemachine_purpose_2}}

          **Visual Scripting Integration:**
          - {{visual_scripting_usage_1}}: {{vs_purpose_1}}
          - {{visual_scripting_usage_2}}: {{vs_purpose_2}}

          **Integration Architecture:**
          - {{integration_pattern_1}}
          - {{integration_pattern_2}}
      - id: unity-gaming-services-advanced
        title: Advanced Unity Gaming Services Integration
        template: |
          [[LLM: Analyze the project type, target audience, and business model to recommend appropriate Unity Gaming Services integration. For single-player games, focus on Analytics and Cloud Build. For multiplayer games, add Relay, Lobby, and Netcode services. For games with monetization, include Economy and Cloud Save. For competitive games, add Leaderboards and Matchmaking. Consider privacy regulations and data sovereignty requirements for the target regions.]]

          **Core Services Integration:**
          - {{core_service_1}}: {{service_implementation_1}}
          - {{core_service_2}}: {{service_implementation_2}}
          - {{core_service_3}}: {{service_implementation_3}}

          **Advanced Services (Project-Specific):**
          - {{advanced_service_1}}: {{advanced_implementation_1}}
          - {{advanced_service_2}}: {{advanced_implementation_2}}

          **Service Architecture Patterns:**
          - Authentication Flow: {{auth_implementation}}
          - Data Synchronization: {{sync_strategy}}
          - Offline/Online Handling: {{offline_strategy}}

          **Privacy and Compliance:**
          - Data Collection: {{data_collection_policy}}
          - Regional Compliance: {{compliance_requirements}}
          - User Consent: {{consent_management}}
      - id: advanced-rendering
        title: Advanced Unity Features Integration
        template: |
          [[LLM: Analyze project genre, team composition, and content creation workflows to recommend appropriate advanced Unity features integration. For cinematic games or cutscenes, prioritize Timeline and Cinemachine. For games with designer-driven logic, include Visual Scripting. For procedural content, emphasize ProBuilder and terrain tools. For mobile games, focus on performance-oriented features like GPU Instancing and LOD systems. Consider team skills - technical teams can handle code-heavy integrations, mixed teams benefit from visual tools. Evaluate content pipeline - linear content benefits from Timeline, systemic content needs flexible scripting solutions.]]

          **Advanced Features Selection:**
          - Timeline Integration: {{timeline_implementation}}
          - Cinemachine Setup: {{cinemachine_configuration}}
          - Visual Scripting Scope: {{visual_scripting_integration}}

          **Feature Integration Strategy:**
          - Team Workflow Integration: {{workflow_optimization}}
          - Performance Optimization: {{feature_performance}}
          - Content Pipeline: {{content_creation_pipeline}}

          **Advanced Rendering Features:**
          - Shader Graph Integration: {{shader_graph_usage}}
          - VFX Graph Integration: {{vfx_graph_usage}}
          - Post-Processing Pipeline: {{post_processing_setup}}

  - id: scalability-architecture
    title: Scalability and Growth Architecture  
    instruction: |
      Design architecture that can scale with project growth and team expansion:

      1. Plan modular architecture that supports feature additions
      2. Design extensible systems that accommodate new requirements
      3. Plan for team scaling and code ownership patterns
      4. Consider technical debt management and refactoring strategies
      5. Design architecture that supports A/B testing and feature flags

      Focus on sustainable growth patterns that maintain code quality over time.
    elicit: true
    sections:
      - id: modular-architecture-enhanced
        title: Adaptive Modular Architecture Design
        template: |
          [[LLM: Analyze team size, project scope, expected feature growth, and maintenance timeline to recommend appropriate modular architecture patterns. For teams <5 developers, recommend simple feature-based modules. For teams 5-15 developers, recommend domain-driven modules with clear boundaries. For teams >15 developers, recommend microservice-style architecture with strong isolation. Consider project timeline - prototypes need flexible boundaries, production projects need strict module contracts. Evaluate expected feature growth rate to determine extension point complexity.]]

          **Module Architecture Strategy:**
          - Module Complexity: {{module_complexity_level}}
          - Boundary Enforcement: {{boundary_strategy}}
          - Communication Patterns: {{inter_module_communication}}

          **Scalability Patterns:**
          - {{scalability_pattern_1}}: {{pattern_rationale_1}}
          - {{scalability_pattern_2}}: {{pattern_rationale_2}}

          **Team Scaling Considerations:**
          - Code Ownership: {{ownership_model}}
          - Development Workflow: {{scaling_workflow}}
          - Integration Strategy: {{integration_approach}}

          **Architecture Evolution Path:**
          - Phase 1 (MVP): {{mvp_architecture}}
          - Phase 2 (Growth): {{growth_architecture}}
          - Phase 3 (Scale): {{scale_architecture}}
      - id: feature-flag-architecture
        title: Feature Flag and A/B Testing Architecture
        template: |
          **Feature Flag Framework:** {{feature_flag_framework}}

          **Flag Categories:**
          - {{flag_category_1}}: {{category_purpose_1}}
          - {{flag_category_2}}: {{category_purpose_2}}

          **Testing Integration:**
          - {{testing_integration_1}}
          - {{testing_integration_2}}

          **Rollout Strategy:**
          - {{rollout_pattern_1}}
          - {{rollout_pattern_2}}

  - id: maintainability-patterns
    title: Code Maintainability and Technical Debt Management
    instruction: |
      Establish patterns and practices for long-term code maintainability:

      1. Define code organization and architectural patterns
      2. Plan refactoring strategies and technical debt management
      3. Design documentation and knowledge sharing systems  
      4. Plan for code review and quality assurance processes
      5. Consider automated quality checks and code analysis

      Focus on sustainable development practices that scale with team growth.
    elicit: true
    sections:
      - id: coding-standards
        title: Advanced Coding Standards
        template: |
          **Architectural Patterns:**
          - {{pattern_1}}: {{pattern_application_1}}
          - {{pattern_2}}: {{pattern_application_2}}

          **Code Organization:**
          - {{organization_rule_1}}
          - {{organization_rule_2}}

          **Dependency Management:**
          - {{dependency_rule_1}}
          - {{dependency_rule_2}}

          **Quality Gates:**
          - {{quality_gate_1}}: {{gate_criteria_1}}
          - {{quality_gate_2}}: {{gate_criteria_2}}
      - id: technical-debt-management
        title: Technical Debt Management Strategy
        template: |
          **Debt Identification:**
          - {{identification_method_1}}
          - {{identification_method_2}}

          **Debt Prioritization:**
          - {{prioritization_criteria_1}}
          - {{prioritization_criteria_2}}

          **Refactoring Strategy:**
          - {{refactoring_approach_1}}
          - {{refactoring_approach_2}}

          **Prevention Measures:**
          - {{prevention_measure_1}}
          - {{prevention_measure_2}}

  - id: testing-architecture
    title: Advanced Testing Architecture
    instruction: |
      Design comprehensive testing strategy for production readiness:

      1. Plan unit testing, integration testing, and end-to-end testing
      2. Design automated testing pipeline and continuous integration
      3. Plan performance testing and load testing strategies
      4. Consider UI testing and accessibility testing
      5. Design testing for Unity-specific features and platforms

      Focus on test coverage that ensures production reliability and quality.
    elicit: true
    sections:
      - id: test-strategy
        title: Comprehensive Test Strategy
        template: |
          **Testing Pyramid:**
          - {{test_layer_1}}: {{layer_coverage_1}} ({{test_percentage_1}}%)
          - {{test_layer_2}}: {{layer_coverage_2}} ({{test_percentage_2}}%)
          - {{test_layer_3}}: {{layer_coverage_3}} ({{test_percentage_3}}%)

          **Unity-Specific Testing:**
          - {{unity_test_1}}: {{test_approach_1}}
          - {{unity_test_2}}: {{test_approach_2}}

          **Platform Testing:**
          - {{platform_test_1}}: {{test_strategy_1}}
          - {{platform_test_2}}: {{test_strategy_2}}
      - id: automated-testing
        title: Automated Testing Pipeline
        template: |
          **CI/CD Integration:**
          - {{ci_stage_1}}: {{stage_tests_1}}
          - {{ci_stage_2}}: {{stage_tests_2}}

          **Test Automation:**
          - {{automation_1}}: {{automation_scope_1}}
          - {{automation_2}}: {{automation_scope_2}}

          **Performance Testing:**
          - {{performance_test_1}}: {{test_metrics_1}}
          - {{performance_test_2}}: {{test_metrics_2}}

  - id: security-architecture
    title: Security Architecture
    instruction: |
      Design security considerations for production deployment:

      1. Plan data security and encryption strategies
      2. Design secure communication with external services
      3. Consider platform-specific security requirements
      4. Plan for secure storage of sensitive data
      5. Design security monitoring and incident response

      Focus on defense-in-depth security that protects user data and game integrity.
    elicit: true
    sections:
      - id: data-security
        title: Data Security Strategy
        template: |
          **Data Classification:**
          - {{data_class_1}}: {{security_level_1}}
          - {{data_class_2}}: {{security_level_2}}

          **Encryption Strategy:**
          - {{encryption_1}}: {{encryption_purpose_1}}
          - {{encryption_2}}: {{encryption_purpose_2}}

          **Secure Storage:**
          - {{storage_1}}: {{storage_security_1}}
          - {{storage_2}}: {{storage_security_2}}
      - id: communication-security
        title: Secure Communication
        template: |
          **API Security:**
          - {{api_security_1}}
          - {{api_security_2}}

          **Authentication:**
          - {{auth_method_1}}: {{auth_purpose_1}}
          - {{auth_method_2}}: {{auth_purpose_2}}

          **Data Transmission:**
          - {{transmission_security_1}}
          - {{transmission_security_2}}

  - id: monitoring-operations
    title: Production Monitoring and Operations
    instruction: |
      Design monitoring and operational support for production deployment:

      1. Plan application monitoring and alerting systems
      2. Design logging and diagnostics collection
      3. Plan crash reporting and error tracking
      4. Consider user analytics and behavior tracking
      5. Design support tools and debugging capabilities

      Focus on observability that enables rapid issue resolution and user support.
    elicit: true
    sections:
      - id: monitoring-strategy
        title: Performance Profiling and Monitoring Strategy
        template: |
          **Performance Profiling Strategy:**
          - {{profiling_approach_1}}: {{profiling_scope_1}}
          - {{profiling_approach_2}}: {{profiling_scope_2}}

          [[LLM: Analyze target platforms, performance requirements, and project complexity to configure appropriate performance profiling strategy. For mobile projects, emphasize memory profiling and battery usage. For PC/Console projects, focus on GPU profiling and frame time optimization. For VR projects, prioritize frame rate consistency and motion-to-photon latency. Configure automated profiling for CI/CD pipeline based on project complexity - simple projects need basic frame rate monitoring, complex projects need comprehensive CPU/GPU/memory profiling with regression detection.]]

          **Automated Performance Monitoring:**
          - CI/CD Integration: {{ci_performance_monitoring}}
          - Performance Regression Detection: {{regression_detection}}
          - Automated Optimization: {{auto_optimization_rules}}

          **Platform-Specific Profiling:**
          - {{platform_1}} Profiling: {{platform_1_strategy}}
          - {{platform_2}} Profiling: {{platform_2_strategy}}

          **Optimization Workflows:**
          - Asset Optimization: {{asset_optimization_process}}
          - Code Optimization: {{code_optimization_process}}
          - Rendering Optimization: {{rendering_optimization_process}}
      - id: diagnostics-logging
        title: Diagnostics and Logging
        template: |
          **Logging Levels:**
          - {{log_level_1}}: {{level_purpose_1}}
          - {{log_level_2}}: {{level_purpose_2}}

          **Log Collection:**
          - {{collection_method_1}}
          - {{collection_method_2}}

          **Crash Reporting:**
          - {{crash_reporting_1}}
          - {{crash_reporting_2}}

          **Performance Profiling:**
          - {{profiling_1}}: {{profiling_scope_1}}
          - {{profiling_2}}: {{profiling_scope_2}}

  - id: live-operations
    title: Live Operations and Content Management
    instruction: |
      Design systems for live game operations and content updates:

      1. Plan content delivery and update mechanisms
      2. Design live configuration and feature toggles
      3. Plan event and seasonal content systems
      4. Consider user-generated content management
      5. Design customer support and community management tools

      Focus on flexible systems that enable ongoing game evolution and community engagement.
    elicit: true
    sections:
      - id: live-operations-intelligent
        title: Intelligent Live Operations Configuration
        template: |
          [[LLM: Analyze game genre, business model, target audience, and content update frequency to configure appropriate live operations systems. For premium games, focus on content patches and bug fixes. For free-to-play games, emphasize live events, A/B testing, and monetization optimization. For competitive games, add real-time balancing and anti-cheat integration. For narrative games, consider episodic content delivery. Evaluate technical complexity - simple games need basic remote config, complex games need full live ops pipeline with feature flags, remote content, and real-time analytics.]]

          **Live Operations Strategy:**
          - Content Update Frequency: {{update_frequency}}
          - Live Event System: {{live_events_approach}}
          - Remote Configuration: {{remote_config_complexity}}

          **Business Model Integration:**
          - Monetization Support: {{monetization_integration}}
          - A/B Testing Framework: {{ab_testing_setup}}
          - User Segmentation: {{segmentation_strategy}}

          **Technical Implementation:**
          - Content Delivery Pipeline: {{content_pipeline}}
          - Feature Flag System: {{feature_flag_implementation}}
          - Analytics Integration: {{analytics_setup}}

          **Operational Monitoring:**
          - Live Metrics Dashboard: {{metrics_dashboard}}
          - Automated Alerts: {{alert_configuration}}
          - Emergency Response: {{emergency_procedures}}
      - id: live-configuration
        title: Live Configuration Management
        template: |
          **Configuration Categories:**
          - {{config_category_1}}: {{category_scope_1}}
          - {{config_category_2}}: {{category_scope_2}}

          **Update Frequency:**
          - {{update_freq_1}}: {{frequency_rationale_1}}
          - {{update_freq_2}}: {{frequency_rationale_2}}

          **Validation Systems:**
          - {{validation_1}}: {{validation_purpose_1}}
          - {{validation_2}}: {{validation_purpose_2}}

  - id: future-considerations
    title: Future Architecture Considerations
    instruction: |
      Plan for future architectural evolution and technology adoption:

      1. Consider emerging Unity features and ecosystem changes
      2. Plan for potential platform expansion
      3. Design architecture flexibility for requirement changes
      4. Consider team growth and organizational scaling
      5. Plan for technology migration and modernization

      Focus on architectural decisions that provide long-term flexibility and adaptation capabilities.
    elicit: true
    sections:
      - id: technology-roadmap
        title: Technology Evolution Roadmap
        template: |
          **Emerging Technologies:**
          - {{tech_1}}: {{adoption_timeline_1}}
          - {{tech_2}}: {{adoption_timeline_2}}

          **Platform Expansion:**
          - {{platform_expansion_1}}: {{expansion_considerations_1}}
          - {{platform_expansion_2}}: {{expansion_considerations_2}}

          **Architecture Evolution:**
          - {{evolution_1}}: {{evolution_rationale_1}}
          - {{evolution_2}}: {{evolution_rationale_2}}
      - id: migration-strategy
        title: Technology Migration Strategy
        template: |
          **Migration Priorities:**
          - {{migration_1}}: {{priority_rationale_1}}
          - {{migration_2}}: {{priority_rationale_2}}

          **Risk Mitigation:**
          - {{risk_1}}: {{mitigation_strategy_1}}
          - {{risk_2}}: {{mitigation_strategy_2}}

          **Timeline Considerations:**
          - {{timeline_factor_1}}
          - {{timeline_factor_2}}

  - id: architecture-validation
    title: Architecture Validation and Sign-off
    instruction: |
      Validate the complete architecture against project requirements and get stakeholder approval:

      1. Review all architecture phases for consistency and completeness  
      2. Validate against original GDD requirements and technical constraints
      3. Confirm resource requirements and implementation feasibility
      4. Get stakeholder approval for architecture decisions
      5. Plan architecture review and update cycles

      Ensure the complete architecture provides a solid foundation for development.
    elicit: true
    sections:
      - id: checklist-results
        title: Architecture Validation Checklist
        template: |
          **Foundation Architecture:** {{foundation_validation}}
          **Systems Architecture:** {{systems_validation}}
          **Platform Architecture:** {{platform_validation}}
          **Advanced Architecture:** {{advanced_validation}}

          **Consistency Check:**
          - {{consistency_check_1}}: {{check_result_1}}
          - {{consistency_check_2}}: {{check_result_2}}

          **Requirements Validation:**
          - {{requirement_1}}: {{validation_result_1}}
          - {{requirement_2}}: {{validation_result_2}}

          **Stakeholder Approval:**
          - {{stakeholder_1}}: {{approval_status_1}}
          - {{stakeholder_2}}: {{approval_status_2}}

  - id: implementation-roadmap
    title: Implementation Roadmap
    content: |
      This advanced architecture document completes the comprehensive game architecture design. The implementation should proceed in the following phases:

      **Phase 1: Foundation Implementation**
      - Implement Unity project structure and core infrastructure
      - Set up development tools and CI/CD pipeline
      - Establish coding standards and quality gates

      **Phase 2: Core Systems Implementation**
      - Implement game data models and core components  
      - Build gameplay systems and state management
      - Integrate input and scene management systems

      **Phase 3: Platform Integration**
      - Implement platform-specific optimizations
      - Integrate UI and audio systems
      - Complete cross-platform compatibility testing

      **Phase 4: Advanced Features and Production**
      - Integrate advanced Unity features and tools
      - Implement monitoring and operational support
      - Complete security and live operations systems

      Each phase should include appropriate testing, documentation, and stakeholder review before proceeding to the next phase. This architecture provides the complete technical foundation for successful game development and long-term maintenance.